<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/305825 (zh-CN, DDL); Windows/10.0.14393 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="364"/>

<div>
<span><div><font size="2"><span style="line-height: 13.600000381469727px;">day17</span></font></div><div><span style="font-size: 9pt;"><br/></span></div><div><span style="font-size: 9pt;">mongoDb</span></div><div><span style="font-size: 9pt;">    干嘛的：数据库,nosql(非关系型)</span></div><div><span style="font-size: 9pt;">    场景：解决大规模数据集合多重数据种类</span></div><div><span style="font-size: 9pt;">    下载：</span><a href="https://www.mongodb.com/download-center?jmp=nav#community" style="font-size: 9pt;">https://www.mongodb.com/download-center?jmp=nav#community</a></div><div><span style="font-size: 9pt;">    运行服务端：启动数据库服务(服务端)</span></div><div><span style="font-size: 9pt;">        C:\Program Files\MongoDB\Server\3.4\bin</span></div><div><span style="font-size: 9pt;">            命令行： mongod.exe 启动</span></div><div><span style="font-size: 9pt;">            port=27017    默认端口</span></div><div><span style="font-size: 9pt;">            mongodb://127.0.0.1:27017    协议+端口</span></div><div><span style="font-size: 9pt;">    指定数据存储目录：</span></div><div><span style="font-size: 9pt;">        mongod --dbpath c:\data\db  需要指定一定(第一次启动mongoDb数据库服务时)</span></div><div><span style="font-size: 9pt;">    环境变量：不希望每次找到mongod.exe 路径</span></div><div><span style="font-size: 9pt;">        我的电脑-&gt;系统设置-&gt;环境变量-&gt;加入mongod.exe的路径</span></div><div><span style="font-size: 9pt;">    开启客户端: mongo 回车</span></div><div><span style="font-size: 9pt;">        UI: 收费(下载+缴费)</span></div><div><span style="font-size: 9pt;">        命令行(shell):    cmd-&gt;mongo回车    git bash - &gt; mongo回车     webstrom-&gt;dos/linux</span></div><div><span style="font-size: 9pt;">    和mysql对比</span></div><div><span style="font-size: 9pt;">    名词</span></div><div><span style="font-size: 9pt;">        mysql            mongoDb</span></div><div><span style="font-size: 9pt;">        database(库)    database(库)</span></div><div><span style="font-size: 9pt;">        table(表)        collection(集合)</span></div><div><span style="font-size: 9pt;">        row(一条数据)    document(文档)</span></div><div><span style="font-size: 9pt;">        column(字段)    field(区域)</span></div><div><span style="font-size: 9pt;">        ...</span></div><div><span style="font-size: 9pt;">    存储方式:</span></div><div><span style="font-size: 9pt;">        mysql 二维表</span></div><div><span style="font-size: 9pt;">        MongoDB json</span></div><div><span style="font-size: 9pt;">    库操作:</span></div><div><span style="font-size: 9pt;">        查: show dbs</span></div><div><span style="font-size: 9pt;">            db 查看当前库</span></div><div><span style="font-size: 9pt;">        建+使用（切换过去):    use 库名    没有建，有就切换</span></div><div><span style="font-size: 9pt;">        删: db.dropDatabase()  删除当前库</span></div><div><span style="font-size: 9pt;">    集合(表)操作:</span></div><div><span style="font-size: 9pt;">        建：db.createCollection('表名',{配置})</span></div><div><span style="font-size: 9pt;">            配置：{size:文件大小,capped:true,max:条数|文档数} capped定量</span></div><div><span style="font-size: 9pt;">        查：show collections / db.getCollectionNames()</span></div><div><span style="font-size: 9pt;">            db.集合.isCapped() true/false 查询集合是否是定量的</span></div><div><span style="font-size: 9pt;">        删：db.集合.drop()</span></div><div><span style="font-size: 9pt;">    文档(row)操作:</span></div><div><span style="font-size: 9pt;">        增：</span></div><div><span style="font-size: 9pt;">            db.集合.save({}) / db.集合.insert({})  添加一条</span></div><div><span style="font-size: 9pt;">            db.集合.save([{},{}]) / db.集合.insert([{},{}])</span></div><div><span style="font-size: 9pt;">            insert  不会替换相同ID    save会替换</span></div><div><span style="font-size: 9pt;">        删:</span></div><div><span style="font-size: 9pt;">            db.集合.deleteOne({}) 删除的是第一条</span></div><div><span style="font-size: 9pt;">            db.集合.deleteOne({要删数据描述}) 删除的是符合描述第一条</span></div><div><span style="font-size: 9pt;">            db.集合.remove({},true)  一条</span></div><div><span style="font-size: 9pt;">            db.集合.remove({要删数据描述}) 多条</span></div><div><span style="font-size: 9pt;">            db.集合.remove({}) 清空表</span></div><div><span style="font-size: 9pt;">        改:</span></div><div><span style="font-size: 9pt;">            db.集合.udpate({要替换的数据},{替换后的},bl插入,bl全修改)</span></div><div><span style="font-size: 9pt;">            替换后的：</span></div><div><span style="font-size: 9pt;">                {$set:{数据},$inc:{age:1}}</span></div><div><span style="font-size: 9pt;">        查:</span></div><div><span style="font-size: 9pt;">            所有：db.集合.find(条件)</span></div><div><span style="font-size: 9pt;">            条数: db.集合.find().count()</span></div><div><span style="font-size: 9pt;">            去重：db.集合.distinct(key) 查key</span></div><div><span style="font-size: 9pt;">            条件</span></div><div><span style="font-size: 9pt;">                {age:22}        age == 22</span></div><div><span style="font-size: 9pt;">                {age:{$gt:22}}    age &gt; 22</span></div><div><span style="font-size: 9pt;">                {age:{$lt:22}}    age &lt; 22</span></div><div><span style="font-size: 9pt;">                {age:{$gte:22}}    age&gt;=22</span></div><div><span style="font-size: 9pt;">                {age:{$lte:22}}    age&lt;=22</span></div><div><span style="font-size: 9pt;">                {age:{$lte:122,$gte:22}}    age&lt;=122 &amp;&amp; age&gt;=22</span></div><div><span style="font-size: 9pt;">                {$or:[{age:22},{age:122}]}    22 or 122</span></div><div><span style="font-size: 9pt;">                {key:value,key2,value2}  value &amp;&amp; value2</span></div><div><span style="font-size: 9pt;">                {name:/正则/}</span></div><div><span style="font-size: 9pt;">            db.集合.find({条件},{指定要显示列区域})</span></div><div><span style="font-size: 9pt;">                指定要显示列区域: 区域名username:1 显示着个区域，其他不显示</span></div><div><span style="font-size: 9pt;">                指定要显示列区域: 区域名username:0 不显示着个区域，其他显示</span></div><div><span style="font-size: 9pt;">                _id 是默认显示</span></div><div><span style="font-size: 9pt;">            限定：</span></div><div><span style="font-size: 9pt;">                db.集合.find().limit(number)  限定</span></div><div><span style="font-size: 9pt;">                db.集合.find().skip(number)    跳过</span></div><div><span style="font-size: 9pt;">                db.集合.findOne() / db.集合.find().limit(1)  查询第一条</span></div><div><span style="font-size: 9pt;">        排</span></div><div><span style="font-size: 9pt;">            升：db.集合.find().sort({key:1})</span></div><div><span style="font-size: 9pt;">            降：db.集合.find().sort({key:-1})</span></div><div><span style="font-size: 9pt;">        db.集合.find({条件},{指定显示区域}).skip(页码*一页条数).limit(一页条数).sort({key:1})</span></div><div><span style="font-size: 9pt;">nodejs + mongodb</span></div><div><span style="font-size: 9pt;">    1.    require('mongodb'); 引入模块 需要npm安装</span></div><div><span style="font-size: 9pt;">    2.    创建客户端    mongoCt = mongodb.MongoClient</span></div><div><span style="font-size: 9pt;">    3.    链接库    mongoCt.connect('协议://地址:端口/库名',回调(err,db))</span></div><div><span style="font-size: 9pt;">        db 库对象</span></div><div><span style="font-size: 9pt;">    4.    链接集合（表)    user = db.collection('集合名');</span></div><div><span style="font-size: 9pt;">    5.    user.API()  表操作        返回 对象</span></div><div><span style="font-size: 9pt;">        user.API().toArray((err,result)=&gt;{reulst==arr})</span></div><div><span style="font-size: 9pt;">------------------------------------------------------------------</span></div><div><span style="font-size: 9pt;">nodejs + express + 脚手架 + mongodb</span></div><div><span style="font-size: 9pt;">脚手架：</span></div><div><span style="font-size: 9pt;">    干嘛的：自动搭建项目环境的，无需手动</span></div><div><span style="font-size: 9pt;">        命令行： 脚手架名称 目录 回车</span></div><div><span style="font-size: 9pt;">    安装：需要安装到全局</span></div><div><span style="font-size: 9pt;">        npm install express -g   验证 express -h</span></div><div><span style="font-size: 9pt;">        提示错误:    npm install express -generator -g</span></div><div><span style="font-size: 9pt;">    创建项目:</span></div><div><span style="font-size: 9pt;">    问题：每次都需要重启服务，需要自动重启服务</span></div><div><span style="font-size: 9pt;">    安装： npm i supervisor -g  命令行工具</span></div><div><span style="font-size: 9pt;">    通过supervisor 启动服务： supervisor server.js|./bin/www</span></div><div><span style="font-size: 9pt;">----------------------------------------------------------------------</span></div><div><span style="font-size: 9pt;">nodejs + express + 脚手架 + mongodb|mysql</span></div><div><span style="font-size: 9pt;">    后端渲染: ejs   res.render('xx.ejs',{数据})</span></div><div><span style="font-size: 9pt;">    前端渲染: res.send(数据)   前端 ajax 接受 -&gt; js/jq/art-tempalte 渲染</span></div><div><span style="font-size: 9pt;">nodejs + express + 脚手架 + proxy(代理数据,抓取异步数据,发送http请求)</span></div><div><span style="font-size: 9pt;">    豆瓣开放api</span></div><div><span style="font-size: 9pt;">    qq音乐开放api</span></div><div><span style="font-size: 9pt;">    ....</span></div><div><span style="font-size: 9pt;">豆瓣:</span></div><div><a href="https://api.douban.com/" style="font-size: 9pt;">https://api.douban.com</a><span style="font-size: 9pt;">  主机名</span></div><div><span style="font-size: 9pt;">    port: 443</span></div><div><span style="font-size: 9pt;">    path: /v2/.....     ? start=xx&amp;count=oo</span></div><div><span style="font-size: 9pt;">    method:'GET'</span></div><div><span style="font-size: 9pt;">代理:  nodejs 的http|https模块 ，使用request的API 发送 http请求</span></div><div><span style="font-size: 9pt;">    </span></div><div><span style="font-size: 9pt;">  options={</span></div><div><span style="font-size: 9pt;">    hostname:'</span><a href="http://api.douban.com/" style="font-size: 9pt;">api.douban.com</a><span style="font-size: 9pt;">',</span></div><div><span style="font-size: 9pt;">    port:443,</span></div><div><span style="font-size: 9pt;">    path:'/v2/movie/top250?[apiKey=xxx]&amp;count='+req.query.count,</span></div><div><span style="font-size: 9pt;">    method:'GET'</span></div><div><span style="font-size: 9pt;">  };</span></div><div><span style="font-size: 9pt;">  require('http|https')  -&gt; 发送http[s]请求</span></div><div><span style="font-size: 9pt;">  reqHttp=http[s].request(配置项,回调(响应对象resHttp))    返回请求对象reqHttp</span></div><div><span style="font-size: 9pt;">      resHttp 响应对象</span></div><div><span style="font-size: 9pt;">    resHttp.statusCode 状态码  200 OK</span></div><div><span style="font-size: 9pt;">    resHttp.headers 获取响应头信息</span></div><div><span style="font-size: 9pt;">    resHttp.setEncoding('utf-8') 设置编码方式</span></div><div><span style="font-size: 9pt;">    resHttp.on('data/end',fn)</span></div><div><span style="font-size: 9pt;">  });</span></div><div><span style="font-size: 9pt;">  reqHttp 请求对象</span></div><div><span style="font-size: 9pt;">  reqHttp.on('error',(err)=&gt;{console.log(err)});    监听请求失败信息</span></div><div><span style="font-size: 9pt;">  reqHttp.end();请求结束</span></div><div><span style="font-size: 9pt;">------------------------------------------------------</span></div><div><span style="font-size: 9pt;">nodeJs 项目:</span></div><div><span style="font-size: 9pt;">    2阶段jq项目 + art-template + mongodb/mysql + nodejs + 购物车存库里</span></div><div><span style="font-size: 9pt;">        </span></div><div><span style="font-size: 9pt;">    2阶段jq项目 + proxy + nodejs  选作</span></div><div><span style="font-size: 9pt;">    bootstrap + proxy/mongodb + nodejs  √</span></div><div><span style="font-size: 9pt;">------------------------------------------------------</span></div><div><span style="font-size: 9pt;">socket：需要安装库</span></div><div><span style="font-size: 9pt;">    </span></div><div><span style="font-size: 9pt;">    干嘛的：聊天室，是个服务</span></div><div><span style="font-size: 9pt;">    原理：网络上两个或多个程序双向通讯、数据交互、允许双向跨域，ajax是单项（客户-》服务）</span></div><div><span style="font-size: 9pt;">    协议： http/https/ftp(文件传输)/tennect/mysql/mongodb/socket</span></div><div><span style="font-size: 9pt;">    协议地址：IP：端口</span></div><div><span style="font-size: 9pt;">    通讯流程：</span></div><div><span style="font-size: 9pt;">    服务端：服务端创建socket服务-&gt;客户端链接-》客户端写|发送socket信息|关闭socket 链接</span></div><div><span style="font-size: 9pt;">        创建服务|接收信息（消息、链接失败错误、下线）| 发送信息</span></div><div><span style="font-size: 9pt;">    客户端：创建socket链接-&gt;接受服务的推送的socket信息|关闭服务</span></div><div><span style="font-size: 9pt;">        链接服务|接收信息(服务转发过来的其他客户端的消息/监听有关服务器失败错误下线)|发送socket</span></div><div><span style="font-size: 9pt;">    nodeJs:    net 模块   nodejs &lt;-&gt; nodejs</span></div><div><span style="font-size: 9pt;">    webSocket: 服务端(nodejs+ws 系统模块)  客户端：H5 webSocket API   兼容IE9+</span></div><div><span style="font-size: 9pt;">    socket.io: 服务端(nodejs + socket.io安装) 客户端: src=&quot;socket.io&quot; 安装</span></div><div><span style="font-size: 9pt;">        socket.io  API(创建服务/写/读/监听)</span></div><div><span style="font-size: 9pt;">    webSocket:</span></div><div><span style="font-size: 9pt;">        服务端：</span></div><div><span style="font-size: 9pt;">            创建服务：</span></div><div><span style="font-size: 9pt;">                1.WebSocketServer=require('ws').Server  返回 socket类</span></div><div><span style="font-size: 9pt;">                2.sktServer=new WebSocketServer({port:9000}) 实例化一个socket服务对象</span></div><div><span style="font-size: 9pt;">            收消息(读socket):</span></div><div><span style="font-size: 9pt;">                sktServer.on('connection',(clientSocket)=&gt;{})检测连接</span></div><div><span style="font-size: 9pt;">                    clientSocket == 客户端socket对象</span></div><div><span style="font-size: 9pt;">                    clientSocket.on('message',()=&gt;{mess}) 接受当前客户端消息</span></div><div><span style="font-size: 9pt;">                        mess == 客户端过来的消息</span></div><div><span style="font-size: 9pt;">                    clientSocket.on('close',()=&gt;{})   客户端下线</span></div><div><span style="font-size: 9pt;">            写消息(写socket):</span></div><div><span style="font-size: 9pt;">                clientSocket.send(消息)</span></div><div><span style="font-size: 9pt;">        客户端：</span></div><div><span style="font-size: 9pt;">            链接服务:</span></div><div><span style="font-size: 9pt;">                1. clientSocket=new WebSocket('ws://127.0.0.1:9000')</span></div><div><span style="font-size: 9pt;">                    创建socket|链接服务|在没有成功的情况会频繁链接服务</span></div><div><span style="font-size: 9pt;">            事件：</span></div><div><span style="font-size: 9pt;">                clientSocket.onopen=function(){} 链接成功，就只会调用一次</span></div><div><span style="font-size: 9pt;">            收消息(读socket):</span></div><div><span style="font-size: 9pt;">                clientSocket.onmessage=function(ev){ev.data==接受到的消息}</span></div><div><span style="font-size: 9pt;">                clientSocket.onerror=function(){}    服务连接错误</span></div><div><span style="font-size: 9pt;">                clientSocket.onclose=function(){}   服务端关闭</span></div><div><span style="font-size: 9pt;">            写消息(写socket):</span></div><div><span style="font-size: 9pt;">                clientSocket.send('上线了')</span></div><div><span style="font-size: 9pt;">    socket.io:    兼容通过H5的websockt ,不兼容通过io自己的方式</span></div><div><span style="font-size: 9pt;">        服务端： npm install socket.io@1.7.4 --D</span></div><div><span style="font-size: 9pt;">            创建服务：express4 方式</span></div><div><span style="font-size: 9pt;">                app = express();//搭建http服务</span></div><div><span style="font-size: 9pt;">                http = require('http').Server(app)</span></div><div><span style="font-size: 9pt;">                io = require('socket.io')(http)</span></div><div><span style="font-size: 9pt;">                http.listen(9000)  注意9000端口不可以和http接口服务端口一样</span></div><div><span style="font-size: 9pt;">            收消息(读socket):</span></div><div><span style="font-size: 9pt;">                io.on('connection',(clientSocket)=&gt;{})检测连接</span></div><div><span style="font-size: 9pt;">                    clientSocket == 客户端socket对象</span></div><div><span style="font-size: 9pt;">                    clientSocket.on('message',()=&gt;{mess}) 接受当前客户端消息</span></div><div><span style="font-size: 9pt;">                        mess == 客户端过来的消息</span></div><div><span style="font-size: 9pt;">                    clientSocket.on('disconnect',()=&gt;{})   客户端下线</span></div><div><span style="font-size: 9pt;">            写消息(写socket):</span></div><div><span style="font-size: 9pt;">                clientSocket.send(消息)</span></div><div><span style="font-size: 9pt;">        客户端：官网下载:     </span><a href="https://socket.io/" style="font-size: 9pt;">https://socket.io/</a><span style="font-size: 9pt;">  注意，版本要对应</span></div><div><span style="font-size: 9pt;">            链接服务:</span></div><div><span style="font-size: 9pt;">                1. clientSocket=io.connect('</span><a href="http://localhost:9000'/" style="font-size: 9pt;">http://localhost:9000'</a><span style="font-size: 9pt;">;)</span></div><div><span style="font-size: 9pt;">                    创建socket|链接服务|在没有成功的情况会频繁链接服务</span></div><div><span style="font-size: 9pt;">            事件：</span></div><div><span style="font-size: 9pt;">                clientSocket.on('connect', function ()) 链接成功，就只会调用一次</span></div><div><span style="font-size: 9pt;">            收消息(读socket):</span></div><div><span style="font-size: 9pt;">                clientSocket.on('message',function(ev){mess==接受到的消息})</span></div><div><span style="font-size: 9pt;">                clientSocket.on('disconnect',function(){})   服务端关闭</span></div><div><span style="font-size: 9pt;">            写消息(写socket):</span></div><div><span style="font-size: 9pt;">                clientSocket.send(消息)</span></div><div><br style="font-size: 9pt;"/></div></span>
</div></body></html> 