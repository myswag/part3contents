<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/305825 (zh-CN, DDL); Windows/10.0.14393 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="356"/>

<div>
<span><div><span style="font-size: 9pt;">day13（前半部分为昨天day12内容，后半部分为今天内容，下有标注：）</span></div><div><span style="font-size: 9pt;"><br/></span></div><div><span style="font-size: 9pt;">模块化（文件）:</span></div><div><span style="font-size: 9pt;">    require        module         exports</span></div><div><span style="font-size: 9pt;">    require 引入模块、输入</span></div><div><span style="font-size: 9pt;">        require('模块名')</span></div><div><span style="font-size: 9pt;">            不指定路径：    先找系统模块-&gt; 在再找node_modules (依赖模块)-&gt;not found</span></div><div><span style="font-size: 9pt;">            指定./xx/模块名     指定路径 -&gt; not found</span></div><div><span style="font-size: 9pt;">    exports 导出，输出</span></div><div><span style="font-size: 9pt;">        exports.自定义属性=值(any)</span></div><div><span style="font-size: 9pt;">    module 模块</span></div><div><span style="font-size: 9pt;">        module.exports == exports</span></div><div><span style="font-size: 9pt;">        module.exports = {</span></div><div><span style="font-size: 9pt;">            自定义属性：值</span></div><div><span style="font-size: 9pt;">        }</span></div><div><span style="font-size: 9pt;">    系统模块: http / fs / querystring / url</span></div><div><span style="font-size: 9pt;">    commonJS 是 nodejs 默认模块方式,不支持es6的模块化管理，但支持所有es语法</span></div><div><span style="font-size: 9pt;">        commonJS 是个规范 nodejs / webpack 是一个实现</span></div><div><span style="font-size: 9pt;">        ECMA 是个规范  js / as 实现了</span></div><div><span style="font-size: 9pt;">npm:  最开始是个网站（</span><a href="http://npmjs.org/" style="font-size: 9pt;">npmjs.org</a><span style="font-size: 9pt;">）,收集前后端所有的程序包,也是一个命令行工具</span></div><div><span style="font-size: 9pt;">    干嘛的：帮助你安装模块（包），自动安装依赖，管理包（增，删，更新，项目所有包)</span></div><div><span style="font-size: 9pt;">    类似：    bower        yarn</span></div><div><span style="font-size: 9pt;">    全局：任何目录c/d/e，项目环境下都可以使用</span></div><div><span style="font-size: 9pt;">    安装、卸载到全局</span></div><div><span style="font-size: 9pt;">    npm install 包名 -g            g==golbal            yarn add 包名</span></div><div><span style="font-size: 9pt;">    npm uninstall 包名 -g            g==golbal</span></div><div><span style="font-size: 9pt;">    安装、卸载到本地项目目录</span></div><div><span style="font-size: 9pt;">    npm install 包名</span></div><div><span style="font-size: 9pt;">    npm uninstall 包名</span></div><div><span style="font-size: 9pt;">    查看已安装:        npm list  列出所有已装包</span></div><div><span style="font-size: 9pt;">                    npm outdated 版本对比(安装过得包)</span></div><div><span style="font-size: 9pt;">                    npm info 包名 查看当前包所有信息</span></div><div><span style="font-size: 9pt;">    管理模块(项目):    </span></div><div><span style="font-size: 9pt;">        npm init 初始化npm管理文件(package.json)</span></div><div><span style="font-size: 9pt;">            {</span></div><div><span style="font-size: 9pt;">              &quot;name&quot;: &quot;npm&quot;,    项目名称</span></div><div><span style="font-size: 9pt;">              &quot;version&quot;: &quot;0.0.1&quot;,    版本</span></div><div><span style="font-size: 9pt;">              &quot;description&quot;: &quot;test and play&quot;,    描述</span></div><div><span style="font-size: 9pt;">              &quot;main&quot;: &quot;index.js&quot;, 入口文件</span></div><div><span style="font-size: 9pt;">              &quot;dependencies&quot;: {  项目依赖  上线也要用</span></div><div><span style="font-size: 9pt;">                &quot;jquery&quot;: &quot;^3.2.1&quot;</span></div><div><span style="font-size: 9pt;">              },</span></div><div><span style="font-size: 9pt;">              &quot;devDependencies&quot;: { 开发依赖 上线就不用</span></div><div><span style="font-size: 9pt;">                &quot;animate.css&quot;: &quot;^3.5.2&quot;</span></div><div><span style="font-size: 9pt;">              },</span></div><div><span style="font-size: 9pt;">              &quot;scripts&quot;: {    命令行</span></div><div><span style="font-size: 9pt;">                &quot;test&quot;: &quot;命令行&quot;</span></div><div><span style="font-size: 9pt;">              },</span></div><div><span style="font-size: 9pt;">              &quot;repository&quot;: {    仓库信息</span></div><div><span style="font-size: 9pt;">                &quot;type&quot;: &quot;git&quot;,</span></div><div><span style="font-size: 9pt;">                &quot;url&quot;: &quot;git+</span><a href="https://github.com/alexwa9.github.io/2017-8-28.git%22" style="font-size: 9pt;">https://github.com/alexwa9.github.io/2017-8-28.git&quot;</a><span style="font-size: 9pt;">;</span></div><div><span style="font-size: 9pt;">              },</span></div><div><span style="font-size: 9pt;">              &quot;keywords&quot;: [  //关键词</span></div><div><span style="font-size: 9pt;">                &quot;test&quot;,'xx','oo'</span></div><div><span style="font-size: 9pt;">              ],</span></div><div><span style="font-size: 9pt;">              &quot;author&quot;: &quot;wan9&quot;,</span></div><div><span style="font-size: 9pt;">              &quot;license&quot;: &quot;ISC&quot;,    认证</span></div><div><span style="font-size: 9pt;">              &quot;bugs&quot;: {</span></div><div><span style="font-size: 9pt;">                &quot;url&quot;: &quot;</span><a href="https://github.com/alexwa9.github.io/2017-8-28/issues%22" style="font-size: 9pt;">https://github.com/alexwa9.github.io/2017-8-28/issues&quot;</a><span style="font-size: 9pt;">;</span></div><div><span style="font-size: 9pt;">              },</span></div><div><span style="font-size: 9pt;">              &quot;homepage&quot;: &quot;</span><a href="https://github.com/alexwa9.github.io/2017-8-28#readme&quot;" style="font-size: 9pt;">https://github.com/alexwa9.github.io/2017-8-28#readme&quot;</a><span style="font-size: 9pt;">;</span></div><div><span style="font-size: 9pt;">            }</span></div><div><span style="font-size: 9pt;">    安装到项目依赖</span></div><div><span style="font-size: 9pt;">        npm install 包名 --save  /  -S</span></div><div><span style="font-size: 9pt;">    安装到开发依赖</span></div><div><span style="font-size: 9pt;">        npm install 包名 --save-dev /  -D</span></div><div><span style="font-size: 9pt;">    安装package.json里面指定的所有包:</span></div><div><span style="font-size: 9pt;">        npm install</span></div><div><span style="font-size: 9pt;">    版本约束：</span></div><div><span style="font-size: 9pt;">        ^x.x.x   约束主版本，后续找最新</span></div><div><span style="font-size: 9pt;">        ~x.x.x   保持前两位不变，后续找最新</span></div><div><span style="font-size: 9pt;">        *         装最新</span></div><div><span style="font-size: 9pt;">        x.x.x      定死了一个版本</span></div><div><span style="font-size: 9pt;">    选择源</span></div><div><span style="font-size: 9pt;">        npm install nrm -g     安装选择源的工具包</span></div><div><span style="font-size: 9pt;">        nrm ls 查看所有源</span></div><div><span style="font-size: 9pt;">        nrm test 测试所有源</span></div><div><span style="font-size: 9pt;">        nrm use 源名</span></div><div><span style="font-size: 9pt;">    模块下载    (卡顿)   超过5分钟</span></div><div><span style="font-size: 9pt;">        ctrl + c -&gt; npm uninstall 包名 -&gt; npm cache clean清除缓存 -&gt; npm install 包名</span></div><div><span style="font-size: 9pt;">    发布模块：</span></div><div><span style="font-size: 9pt;">        注册账号     </span><a href="http://npmjs.org/" style="font-size: 9pt;">npmjs.org</a></div><div><span style="font-size: 9pt;">        登录:</span></div><div><span style="font-size: 9pt;">            npm login</span></div><div><span style="font-size: 9pt;">                输入 user/password/email</span></div><div><span style="font-size: 9pt;">        创建包目录-&gt;npm init -y -&gt; 创建入口index.js -&gt; 编写，输出-&gt;npm login(登录到npm不是镜像)-&gt; npm publish发布 -&gt; npm install 自定义包名 -&gt; reqire('xx')</span></div><div><span style="font-size: 9pt;">        发布：npm publish -&gt; 发布多次(需要升版本号version)</span></div><div><span style="font-size: 9pt;">        删除：npm unpublish  在package.json所在的位置去操作</span></div><div><span style="font-size: 9pt;">            删除一次,最新版本号</span></div><div><span style="font-size: 9pt;">        发布操作长时间没有做，邮箱需要确认，收取激活邮件</span></div><div><span style="font-size: 9pt;">----------------------------------------------------------------------</span></div><div><span style="font-size: 9pt;">express  库</span></div><div><span style="font-size: 9pt;">    干嘛的：nodejs库，不用基础做起，工作简单化</span></div><div><span style="font-size: 9pt;">    类似：koa</span></div><div><span style="font-size: 9pt;">    express: 对原生nodeJs，二次封装，不完全一样，非侵入式，第三方增强,主要依赖中间件</span></div><div><span style="font-size: 9pt;">安装：npm init -y -&gt; npm install express -D</span></div><div><span style="font-size: 9pt;">搭建服务器:    express();  返回  app/server</span></div><div><span style="font-size: 9pt;">监听: server.listen(8001)</span></div><div><span style="font-size: 9pt;">响应请求：server|app.get/post/use(地址,(req,res,next)=&gt;{})</span></div><div><span style="font-size: 9pt;">          use 响应get和post请求</span></div><div><span style="font-size: 9pt;">          req / res 经过二次封装</span></div><div><span style="font-size: 9pt;">              res.send(any)    == res.write + end</span></div><div><span style="font-size: 9pt;">              req.query 获取get的数据</span></div><div><span style="font-size: 9pt;">              req.body 获取post的数据  依赖中间件  body-parser</span></div><div><span style="font-size: 9pt;">              req.method 获取前端提交方式</span></div><div><span style="font-size: 9pt;">          next: 是个函数 调用下一个相同地址的响应,除了/</span></div><div><span style="font-size: 9pt;"><br/></span></div><div><span style="font-size: 9pt;">（以上为昨天day12天内容，以下为今天day13内容：）</span></div><div><span style="font-size: 9pt;">------------------------------------------------------------------------<span style="font-size: 9pt;">--------------------------------------</span></span></div><div><span style="font-size: 9pt;">----------------------------------------------------------------------<span style="font-size: 9pt;">--</span><span style="font-size: 9pt;">--------------------------------------</span><span style="font-size: 9pt;"><br/></span></span></div><div><span style="font-size: 9pt;"><br/></span></div><div><span style="font-size: 9pt;">中间件: body-parser</span></div><div><span style="font-size: 9pt;">安装-&gt;引入-&gt; 配置 app|server.use(中间件.key({配置}))</span></div><div><span style="font-size: 9pt;">    就是流水线的一个中间环节，配合use来处理，是express的一大亮点</span></div><div><span style="font-size: 9pt;">中间件:    </span></div><div><span style="font-size: 9pt;">    如何识别同一个人访问了服务器（用户唯一性判断）?</span></div><div><span style="font-size: 9pt;">    http协议，http无状态</span></div><div><span style="font-size: 9pt;">    通过给客户端浏览器保存一些信息，每次访问服务器带着信息(校验)</span></div><div><span style="font-size: 9pt;">            （服务器给浏览器写cookie）           cookie &lt;-&gt;session</span></div><div><span style="font-size: 9pt;">        需要中间件: cookie-parser  cookie-sesion</span></div><div><span style="font-size: 9pt;">        流程：浏览器-&gt;服务器-&gt;给浏览器种cookie(服务器保留一份seesionID)-&gt;下次浏览器(带着cookie)-&gt;服务器(利用seesionID和cookie对比)-&gt;返回内容</span></div><div><span style="font-size: 9pt;">        cookie-parser：</span></div><div><span style="font-size: 9pt;">            res.cookie(key,value,{配置}) 种</span></div><div><span style="font-size: 9pt;">            req.cookies 返回 cookie</span></div><div><span style="font-size: 9pt;">            res.clearCookie(key) 清除某一个</span></div><div><span style="font-size: 9pt;">        cookie-session:</span></div><div><span style="font-size: 9pt;">            写：    req.session.key=value</span></div><div><span style="font-size: 9pt;">            读：    req.session</span></div><div><span style="font-size: 9pt;">            删:        req.session.key = undefined</span></div><div><span style="font-size: 9pt;">multer:    </span></div><div><span style="font-size: 9pt;">    文件上传：前端表单-&gt;后端接收到文件本身-&gt;保存到服务器上-&gt;给数据库记录文件一些信息-&gt;库返回给nodejs相关信息-&gt;nodejs返回给前端-&gt;前端渲染显示</span></div><div><span style="font-size: 9pt;">            前端: file enctype=&quot;multipart/form-data&quot;</span></div><div><span style="font-size: 9pt;">            后端：multer</span></div><div><span style="font-size: 9pt;">        let multer  = require('multer');    引入</span></div><div><span style="font-size: 9pt;">        let objMulter = multer({ dest: './upload' });    实例化  返回 multer对象</span></div><div><span style="font-size: 9pt;">            dest: 指定 保存位置（存到服务器)</span></div><div><span style="font-size: 9pt;">        app.use(objMulter.any());      any 允许上传任何文件</span></div><div><span style="font-size: 9pt;">        req.files    数组</span></div><div><span style="font-size: 9pt;">            fieldname: 表单name名</span></div><div><span style="font-size: 9pt;">            originalname: 上传的文件名</span></div><div><span style="font-size: 9pt;">            encoding： 编码方式</span></div><div><span style="font-size: 9pt;">            mimetype: 文件类型</span></div><div><span style="font-size: 9pt;">            buffer: 文件本身</span></div><div><span style="font-size: 9pt;">            size：尺寸</span></div><div><span style="font-size: 9pt;">            destination: 保存路径</span></div><div><span style="font-size: 9pt;">            filename： 保存后的文件名  不含后缀</span></div><div><span style="font-size: 9pt;">            path：    保存磁盘路径+保存后的文件名 不含后缀c:\\wamp\\xx.png</span></div><div><span style="font-size: 9pt;">        fs.rename('当前文件','修改后后的文件名',(err)=&gt;{});</span></div><div><span style="font-size: 9pt;">        path.parse('c:\\wamp\\xx.png');    磁盘路径(str -&gt; obj)</span></div><div><span style="font-size: 9pt;">            {</span></div><div><span style="font-size: 9pt;">                root: 'c:\\', 盘符</span></div><div><span style="font-size: 9pt;">               dir: 'c:\\wamp', 目录</span></div><div><span style="font-size: 9pt;">               base: 'xx.png',  文件名</span></div><div><span style="font-size: 9pt;">               ext: '.png', 扩展名</span></div><div><span style="font-size: 9pt;">               name: 'xx'     文件，不含扩展名</span></div><div><span style="font-size: 9pt;">            }</span></div><div><span style="font-size: 9pt;">        path.join('磁盘路径1','磁盘路径2')</span></div><div><span style="font-size: 9pt;">            __dirname 魔术变量  返回当前文件所在的磁盘路径</span></div><div><span style="font-size: 9pt;">大后端:</span></div><div><span style="font-size: 9pt;">    用户 - &gt; 地址栏(http[s]请求) -&gt; web服务器（收到) - &gt; nodejs处理请求(返回静态、动态)-&gt;请求数据库服务(返回结果)-&gt;nodejs(接收)-&gt;渲染页面-&gt;浏览器（接收页面，完成最终渲染)</span></div><div><span style="font-size: 9pt;">大前端:</span></div><div><span style="font-size: 9pt;">    前端 - &gt; http[s]请求 -&gt; web服务器（收到) - &gt; nodejs处理请求(返回静态)-&gt;请求数据库服务(返回结果)-&gt;nodejs(接收)-&gt;返回给前端(渲染)-&gt;浏览器（接收页面，完成最终渲染)</span></div><div><span style="font-size: 9pt;">模板引擎</span></div><div><span style="font-size: 9pt;">    前端：dom操作            虚拟dom操作    二次渲染，后期多次渲染， 优点：局部渲染</span></div><div><span style="font-size: 9pt;">          jq/js/angualr        vue/react/.......   渲染页面(数据整合到静态页面)</span></div><div><span style="font-size: 9pt;">    后端：</span></div><div><span style="font-size: 9pt;">          抓取前端静态页面 + 渲染引擎 + 数据  返回data -&gt;  send(data)</span></div><div><span style="font-size: 9pt;">          渲染引擎: jade / ejs / ....</span></div><div><span style="font-size: 9pt;">    arttemplate  underscore baiduTemplate mustach .......</span></div><div><span style="font-size: 9pt;">jade:</span></div><div><span style="font-size: 9pt;">    侵入式，强依赖</span></div><div><span style="font-size: 9pt;">    jade.render('html'); 返回字符</span></div><div><span style="font-size: 9pt;">    jade.renderFile('jade模板文件');    返回字符</span></div><div><span style="font-size: 9pt;">    jade模板语法</span></div><div><span style="font-size: 9pt;">        父子要缩进</span></div><div><span style="font-size: 9pt;">        属性：  标签(key=value,key2=value)</span></div><div><span style="font-size: 9pt;">        内容:    标签 内容</span></div><div><span style="font-size: 9pt;">ejs：    渲染模板文件，是异步的</span></div><div><span style="font-size: 9pt;">    非侵入式，温和，弱依赖</span></div><div><span style="font-size: 9pt;">    ejs.render(str)  返回  str</span></div><div><span style="font-size: 9pt;">    ejs.renderFile('ejs模板',{数据},回调(err,data))    data == str</span></div><div><span style="font-size: 9pt;">    ejs模板语法：</span></div><div><span style="font-size: 9pt;">        ejs 结构就是html</span></div><div><span style="font-size: 9pt;">        输出:    &lt;%= 数据名|属性名|变量名 + 表达式 %&gt;  </span></div><div><span style="font-size: 9pt;">        语句：    &lt;% 语句 %&gt;  需要被&lt;%  %&gt;  包裹</span></div><div><span style="font-size: 9pt;">        非转义输出:    &lt;%- 数据名|变量名  + 表达式 %&gt;</span></div><div><span style="font-size: 9pt;">------------------------------------------------------------------------</span></div><div><span style="font-size: 9pt;">管理多个模板引擎    consolidate</span></div><div><span style="font-size: 9pt;">    server.set('view.engine','html');    模板最终    输出类型设置</span></div><div><span style="font-size: 9pt;">    server.set('views','./views');        引擎模板目录设置</span></div><div><span style="font-size: 9pt;">    server.engine('html',consolidate.ejs);    输出与引擎匹配</span></div><div><span style="font-size: 9pt;">    server.engine('css',consolidate.jade);    输出与引擎匹配</span></div><div><span style="font-size: 9pt;">    渲染API：</span></div><div><span style="font-size: 9pt;">    res.render('2.jade',{name:'alex'},回调(err,data))  整合页面和数据，完成渲染，发往浏览器</span></div><div><br style="font-size: 9pt;"/></div></span>
</div></body></html> 