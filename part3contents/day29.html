<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/305825 (zh-CN, DDL); Windows/10.0.14393 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="366"/>

<div>
<span><div><span style="font-size: 9pt;">day29</span></div><div><span style="font-size: 9pt;"><br/></span></div><div><span style="font-size: 9pt;">思想:</span></div><div><span style="font-size: 9pt;">    组件拆分目标:为了复用</span></div><div><span style="font-size: 9pt;">    组件如何拆：单一原则</span></div><div><span style="font-size: 9pt;">    状态应该给谁: 尽量给顶层组件(需要共享数据的，最近的父组件),-&gt;props-&gt;子组件</span></div><div><span style="font-size: 9pt;">        props传递，显示传递√    隐式传递 {...this.props} ×</span></div><div><span style="font-size: 9pt;">    setState: 是异步的,所以不能依赖上一个setState的值</span></div><div><span style="font-size: 9pt;">        解决：函数节流，依赖event, 使用方法内部copy之后的state</span></div><div><span style="font-size: 9pt;">路由：</span></div><div><span style="font-size: 9pt;">    干嘛的：根据不同的URL，展示不同的内容</span></div><div><span style="font-size: 9pt;">    安装：npm install react-router@3.0.0 -D</span></div><div><span style="font-size: 9pt;">    引入：import {</span></div><div><span style="font-size: 9pt;">              Router,    路由对象</span></div><div><span style="font-size: 9pt;">              Route,    一个路由配置</span></div><div><span style="font-size: 9pt;">              hashHistory,    哈希模式</span></div><div><span style="font-size: 9pt;">              IndexRoute,    默认路由</span></div><div><span style="font-size: 9pt;">              Link,        路由调用</span></div><div><span style="font-size: 9pt;">              Redirect    重定向</span></div><div><span style="font-size: 9pt;">              browserHistory 历史记录</span></div><div><span style="font-size: 9pt;">            } from 'react-router';</span></div><div><span style="font-size: 9pt;">    配置路由: 路由对象Router，一定要包裹一个根路由</span></div><div><span style="font-size: 9pt;">        Router history={hashHistory}</span></div><div><span style="font-size: 9pt;">            Route path=&quot;/&quot; ..  component={组件}</span></div><div><span style="font-size: 9pt;">                xx</span></div><div><span style="font-size: 9pt;">                xx</span></div><div><span style="font-size: 9pt;">                    oo</span></div><div><span style="font-size: 9pt;">                    oo</span></div><div><span style="font-size: 9pt;">                xx</span></div><div><span style="font-size: 9pt;">                    oo</span></div><div><span style="font-size: 9pt;">                xx</span></div><div><span style="font-size: 9pt;">                &lt;IndexRoute component={组件}&gt;</span></div><div><span style="font-size: 9pt;">                &lt;Redirect from=&quot;来自路径&quot; to=&quot;去向路径&quot;/&gt;</span></div><div><span style="font-size: 9pt;">    调用：</span></div><div><span style="font-size: 9pt;">        Link to=&quot;path名&quot;  转换成DOM a ,不可改</span></div><div><span style="font-size: 9pt;">        path名: string|| {{pathname:'news/003',query:{a:1,b:2}}}</span></div><div><span style="font-size: 9pt;">    展示区:</span></div><div><span style="font-size: 9pt;">        {this.props.children}</span></div><div><span style="font-size: 9pt;">        {this.props.params.aid} 参数</span></div><div><span style="font-size: 9pt;">        {this.props.location.query} 数据</span></div><div><span style="font-size: 9pt;">        {this.props.location.pathname} 路由路径</span></div><div><span style="font-size: 9pt;">    组件内部获取router对象    this.props.router</span></div><div><span style="font-size: 9pt;">        this.props.router.push('xxx')/replace('')/goBack/goForward/go(-1)</span></div><div><span style="font-size: 9pt;">        跳转：this.props.router/ hashHistory/window.history 都是操作历史记录</span></div><div><span style="font-size: 9pt;">    激活后路由样式：</span></div><div><span style="font-size: 9pt;">        activeClassName=&quot;外部css的类名&quot;  </span></div><div><span style="font-size: 9pt;">        activeStyle={json}    json={bacgroundColor:xx}驼峰</span></div><div><span style="font-size: 9pt;">    browserHistory：需要配置webpack服务(package.json + --history-api-fallback)</span></div><div><span style="font-size: 9pt;">---------------------------------------------------------------------------------</span></div><div><span style="font-size: 9pt;">1. 项目分析,组件安排</span></div><div><span style="font-size: 9pt;">|-src</span></div><div><span style="font-size: 9pt;">    |- components</span></div><div><span style="font-size: 9pt;">        |- App</span></div><div><span style="font-size: 9pt;">        |- NavBar / FootBar</span></div><div><span style="font-size: 9pt;">        |- Home / Follow / Column / User</span></div><div><span style="font-size: 9pt;">        |- Article / Login / Reg</span></div><div><span style="font-size: 9pt;">        |- Slider / Error / NewList</span></div><div><span style="font-size: 9pt;">    |- common(filters)</span></div><div><span style="font-size: 9pt;">        |- date.js / fillzero.js</span></div><div><span style="font-size: 9pt;">    |- data</span></div><div><span style="font-size: 9pt;">        |- 数据</span></div><div><span style="font-size: 9pt;">    |- assets</span></div><div><span style="font-size: 9pt;">        |- css</span></div><div><span style="font-size: 9pt;">        |- img</span></div><div><span style="font-size: 9pt;">        |- js</span></div><div><span style="font-size: 9pt;">    |- store</span></div><div><span style="font-size: 9pt;">        |- ..</span></div><div><span style="font-size: 9pt;">    main.js / RouterConfig.js</span></div><div><span style="font-size: 9pt;">index.html</span></div><div><span style="font-size: 9pt;">package.json</span></div><div><span style="font-size: 9pt;">webpack.config.js</span></div><div><span style="font-size: 9pt;">------------------------------------------------</span></div><div><span style="font-size: 9pt;">2. 布局(切图,mint-ui,elementUI...ant),模板移植</span></div><div><span style="font-size: 9pt;">    样式：全局引入</span></div><div><span style="font-size: 9pt;">        src / import</span></div><div><span style="font-size: 9pt;">------------------------------------------------</span></div><div><span style="font-size: 9pt;">3. 路由搭建</span></div><div><span style="font-size: 9pt;">    样式冲突（命名冲突（错开））</span></div><div><span style="font-size: 9pt;">    import 模块名 from '../css/xx.css'</span></div><div><span style="font-size: 9pt;">    模块名.类名</span></div><div><span style="font-size: 9pt;">------------------------------------------------</span></div><div><span style="font-size: 9pt;">4. 数据交互</span></div><div><span style="font-size: 9pt;">    fetch(url).then(fn).catch(fn)</span></div><div><span style="font-size: 9pt;">    home-&gt;newlist      dataName=&quot;home&quot; listData={this.state.listData}</span></div><div><span style="font-size: 9pt;">    follow-&gt;newlist dataName=&quot;follow&quot; listData={this.state.listData}</span></div><div><span style="font-size: 9pt;">    ↓</span></div><div><span style="font-size: 9pt;">    newlist -》link pathname:'article/'+item.id,</span></div><div><span style="font-size: 9pt;">                    query:{dataName:dataName}</span></div><div><span style="font-size: 9pt;">    ↓</span></div><div><span style="font-size: 9pt;">    Article this.props.router.location.query.dataName</span></div><div><span style="font-size: 9pt;">5.    全局方法（过滤事件，补零）</span></div><div><span style="font-size: 9pt;">    |-common</span></div><div><span style="font-size: 9pt;">        date.js</span></div><div><span style="font-size: 9pt;">        fillzero.js</span></div><div><span style="font-size: 9pt;">        ...</span></div><div><span style="font-size: 9pt;">        index.js</span></div><div><span style="font-size: 9pt;">            import date/fillzero ..</span></div><div><span style="font-size: 9pt;">            export {</span></div><div><span style="font-size: 9pt;">                date,fillzero</span></div><div><span style="font-size: 9pt;">            }</span></div><div><span style="font-size: 9pt;">------------------------------------------------</span></div><div><span style="font-size: 9pt;">6. 非状态管理，控制navbar / footbar / loading</span></div><div><span style="font-size: 9pt;">    this.props.router.location.pathname -&gt; navbar / footbar</span></div><div><span style="font-size: 9pt;">    loading -&gt; pubsub [App订阅,  home/follow/.. 发布]</span></div><div><span style="font-size: 9pt;">  问题：用户速度切换，this.setState报错</span></div><div><span style="font-size: 9pt;">  分析：fetch中断--无法中断/isMounted属性(es5)/状态控制(组件卸载了，状态和事件都没了)</span></div><div><span style="font-size: 9pt;">  解决：高光盒（lightBox）√  / 自个维护一个组件属性 this.自定义属性</span></div></span>
</div></body></html> 